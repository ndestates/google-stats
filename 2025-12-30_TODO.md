# 2025-12-30 TODO

## ğŸ¯ Goals
1. [ ] Finalize plan to generate GA4 audiences from catalog/XML feed listings and price ranges.

## ğŸ” Research & Inputs
2. [ ] Locate catalog/XML feed endpoint or file path; document auth, format (XML/JSON), and sample fields (URL, price, status).
3. [ ] Confirm listing URL pattern and canonicalization rules (trailing slash, query params, locale subpaths); decide on dedupe logic.
4. [ ] Validate price field availability/units (GBP) and rounding rules to map listings into ranges (Â£200k-Â£400k, Â£400k-Â£600k, Â£600k-Â£800k, Â£800k-Â£1m, Â£1m+).
5. [ ] Check GA4 audience limits/quotas and naming conventions for per-listing audiences; define naming template e.g., "Listing - {slug}" and "Price Range - Â£X-Â£Y".

## ğŸ“¦ Feed-driven audience mapping (from https://api.ndestates.com/feeds/ndefeed.xml)
6. [ ] Parse feed fields: `url`, `price`, `type` (buy/rent), `status`, `reference`, `propertyname`; ignore unavailable listings.
7. [ ] Generate one page-view audience per available listing (`Listing - {reference}` or slugged name) using `create_page_view_audience` with pageLocation `url`.
8. [ ] Build price-band audiences (only `type=buy`, GBP): Â£200kâ€“Â£400k, Â£400kâ€“Â£600k, Â£600kâ€“Â£800k, Â£800kâ€“Â£1m, Â£1m+; include page paths for listings whose `price` falls in band; consider `type=rent` separately (skip or future bands).
9. [ ] Add dedupe/idempotency: skip audience create if already exists; cap batch size per run to avoid GA4 limits; expose `--limit` and `--dry-run` CLI flags.
10. [ ] Handle URL canonicalization (trailing slash, query params) and ensure case-normalized matches; optionally store feed snapshot to `reports/feeds/` for auditing.

## ğŸ“ Implementation
6. [ ] Add/extend a script (likely `scripts/audience_management.py` or a helper) to fetch the catalog feed and extract listing URLs + prices.
7. [ ] Generate one audience per listing URL (e.g., page-view audiences) using `create_page_view_audience`; ensure safe batching/rate limits and idempotent skips for existing audiences.
8. [ ] Create price-range audiences for specified bands using URL filters or event params derived from feed data; ensure mutually exclusive logic where possible.
9. [ ] Add CLI flags/env config to choose feed source, dry-run vs create, and optional limit on number of audiences created in a run.

## ğŸ“Š Testing & Validation
10. [ ] Run dry-run in DDEV (`ddev exec python3 scripts/audience_management.py ...`) to print would-be audiences and confirm naming/filters.
11. [ ] Execute a controlled create run against test property; verify audiences appear in GA4 Admin and that metrics populate after data accrues.
12. [ ] Document steps and edge cases (missing prices, sold/hidden listings, duplicate URLs) in README or doc section.
